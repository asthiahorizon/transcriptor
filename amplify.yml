version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend
        - yarn install
    build:
      commands:
        - yarn build
  artifacts:
    baseDirectory: frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*

backend:
  phases:
    preBuild:
      commands:
        # Install FFmpeg - download static build
        - curl -L "https://github.com/eugeneware/ffmpeg-static/releases/download/b6.0/ffmpeg-linux-x64" -o /tmp/ffmpeg
        - curl -L "https://github.com/eugeneware/ffmpeg-static/releases/download/b6.0/ffprobe-linux-x64" -o /tmp/ffprobe
        - chmod +x /tmp/ffmpeg /tmp/ffprobe
        - mkdir -p backend/bin
        - cp /tmp/ffmpeg /tmp/ffprobe backend/bin/
        - cd backend
        # Install emergentintegrations from private index, then other deps
        - pip install emergentintegrations --extra-index-url https://d33sy5i8bnduwe.cloudfront.net/simple/
        - pip install -r requirements.txt --extra-index-url https://d33sy5i8bnduwe.cloudfront.net/simple/
    build:
      commands:
        - echo "Backend build complete"
  artifacts:
    baseDirectory: backend
    files:
      - '**/*'
