version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend
        - yarn install
    build:
      commands:
        - yarn build
  artifacts:
    baseDirectory: frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*

backend:
  phases:
    preBuild:
      commands:
        # Install FFmpeg static binary
        - curl -L https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz -o ffmpeg.tar.xz
        - tar -xf ffmpeg.tar.xz
        - mv ffmpeg-*-amd64-static/ffmpeg /usr/local/bin/ffmpeg
        - mv ffmpeg-*-amd64-static/ffprobe /usr/local/bin/ffprobe
        - chmod +x /usr/local/bin/ffmpeg /usr/local/bin/ffprobe
        - rm -rf ffmpeg.tar.xz ffmpeg-*-amd64-static
        - cd backend
        - pip install -r requirements.txt
    build:
      commands:
        - echo "Backend build complete"
  artifacts:
    baseDirectory: backend
    files:
      - '**/*'
