version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd frontend
        - yarn install
    build:
      commands:
        - yarn build
  artifacts:
    baseDirectory: frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*

backend:
  phases:
    preBuild:
      commands:
        # Install FFmpeg - download static build
        - mkdir -p /tmp/ffmpeg
        - cd /tmp/ffmpeg
        - curl -L "https://github.com/eugeneware/ffmpeg-static/releases/download/b6.0/ffmpeg-linux-x64" -o ffmpeg
        - curl -L "https://github.com/eugeneware/ffmpeg-static/releases/download/b6.0/ffprobe-linux-x64" -o ffprobe
        - chmod +x ffmpeg ffprobe
        - cp ffmpeg ffprobe /usr/local/bin/ 2>/dev/null || mkdir -p $CODEBUILD_SRC_DIR/bin && cp ffmpeg ffprobe $CODEBUILD_SRC_DIR/bin/
        - cd $CODEBUILD_SRC_DIR
        - cd backend
        - pip install -r requirements.txt
    build:
      commands:
        - echo "Backend build complete"
  artifacts:
    baseDirectory: backend
    files:
      - '**/*'
